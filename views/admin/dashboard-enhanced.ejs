<%- include('../partials/header') %>
<%- include('../partials/navbar-admin') %>

<div class="dashboard admin-dashboard">
    <div class="container">
        <div class="dashboard-header">
            <div>
                <h1><i class="fas fa-tachometer-alt"></i> Admin Dashboard</h1>
                <p style="color: var(--text-secondary);">Welcome back, <%= adminEmail %></p>
            </div>
            <div class="badge-advanced badge-info">
                <i class="fas fa-clock"></i>
                <%= new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) %>
            </div>
        </div>

        <!-- Enhanced Stats Grid -->
        <div class="stats-grid-advanced" style="margin-bottom: 3rem;">
            <div class="stat-card-advanced">
                <div class="stat-header">
                    <div class="stat-icon-advanced" style="background: var(--gradient-primary);">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-trend">
                        <i class="fas fa-arrow-up"></i>
                        Active
                    </div>
                </div>
                <div class="stat-label-advanced">Total Users</div>
                <div class="stat-value-large"><%= totalUsers %></div>
                <p style="color: var(--text-secondary); font-size: 0.875rem; margin-top: 0.5rem;">
                    Registered accounts
                </p>
            </div>

            <div class="stat-card-advanced">
                <div class="stat-header">
                    <div class="stat-icon-advanced" style="background: var(--gradient-accent);">
                        <i class="fas fa-apple-alt"></i>
                    </div>
                    <div class="badge-advanced badge-warning">
                        Database
                    </div>
                </div>
                <div class="stat-label-advanced">Food Items</div>
                <div class="stat-value-large"><%= totalFoods %></div>
                <p style="color: var(--text-secondary); font-size: 0.875rem; margin-top: 0.5rem;">
                    Available foods
                </p>
            </div>

            <div class="stat-card-advanced">
                <div class="stat-header">
                    <div class="stat-icon-advanced" style="background: var(--gradient-secondary);">
                        <i class="fas fa-envelope"></i>
                    </div>
                    <% if (totalContacts > 0) { %>
                        <div class="stat-trend down">
                            <i class="fas fa-exclamation"></i>
                            New
                        </div>
                    <% } else { %>
                        <div class="stat-trend">
                            <i class="fas fa-check"></i>
                            Clear
                        </div>
                    <% } %>
                </div>
                <div class="stat-label-advanced">Contact Messages</div>
                <div class="stat-value-large"><%= totalContacts %></div>
                <p style="color: var(--text-secondary); font-size: 0.875rem; margin-top: 0.5rem;">
                    Unread messages
                </p>
            </div>

            <div class="stat-card-advanced">
                <div class="stat-header">
                    <div class="stat-icon-advanced" style="background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="badge-advanced badge-info">
                        Today
                    </div>
                </div>
                <div class="stat-label-advanced">Avg Calories</div>
                <div class="stat-value-large"><%= avgCalories %></div>
                <p style="color: var(--text-secondary); font-size: 0.875rem; margin-top: 0.5rem;">
                    kcal per user
                </p>
            </div>
        </div>

        <!-- Quick Actions Tiles -->
        <div style="margin-bottom: 3rem;">
            <h2 style="margin-bottom: 1.5rem; color: var(--text-primary);">Quick Actions</h2>
            <div class="quick-actions-advanced">
                <a href="/admin/users" class="action-card-advanced">
                    <div class="action-icon">
                        <i class="fas fa-users-cog"></i>
                    </div>
                    <h3>Manage Users</h3>
                    <p>View and manage user accounts</p>
                    <div class="action-badge"><%= totalUsers %> users</div>
                </a>
                <a href="/admin/foods" class="action-card-advanced">
                    <div class="action-icon" style="background: var(--gradient-accent);">
                        <i class="fas fa-utensils"></i>
                    </div>
                    <h3>Manage Foods</h3>
                    <p>Add or edit food database</p>
                    <div class="action-badge"><%= totalFoods %> items</div>
                </a>
                <a href="/admin/reports" class="action-card-advanced">
                    <div class="action-icon" style="background: var(--gradient-secondary);">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                    <h3>View Reports</h3>
                    <p>Analytics and insights</p>
                    <div class="action-badge">Analytics</div>
                </a>
                <a href="/admin/contacts" class="action-card-advanced">
                    <div class="action-icon" style="background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);">
                        <i class="fas fa-inbox"></i>
                    </div>
                    <h3>Contact Queries</h3>
                    <p>Review user messages</p>
                    <% if (totalContacts > 0) { %>
                        <div class="action-badge" style="background: var(--danger-color);"><%= totalContacts %> new</div>
                    <% } else { %>
                        <div class="action-badge">No messages</div>
                    <% } %>
                </a>
            </div>
        </div>

        <!-- Recent Users Table -->
        <div class="dashboard-card">
            <div class="chart-header">
                <h2 class="chart-title"><i class="fas fa-user-plus"></i> Recent Users</h2>
                <a href="/admin/users" class="btn-outline btn-sm">View All</a>
            </div>
            <div class="table-responsive">
                <table class="table-advanced">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Joined</th>
                            <th>Streak</th>
                            <th>Goal</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% if (recentUsers.length > 0) { %>
                            <% recentUsers.forEach(user => { %>
                                <tr>
                                    <td>
                                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                                            <div style="width: 40px; height: 40px; border-radius: 50%; background: var(--gradient-primary); display: flex; align-items: center; justify-content: center; color: white; font-weight: 700;">
                                                <%= user.fullName.charAt(0).toUpperCase() %>
                                            </div>
                                            <span style="font-weight: 600;"><%= user.fullName %></span>
                                        </div>
                                    </td>
                                    <td><%= user.email %></td>
                                    <td><%= new Date(user.createdAt).toLocaleDateString() %></td>
                                    <td>
                                        <div class="badge-advanced <%= user.currentStreak >= 7 ? 'badge-success' : user.currentStreak >= 3 ? 'badge-warning' : 'badge-info' %>">
                                            <i class="fas fa-fire"></i>
                                            <%= user.currentStreak %> days
                                        </div>
                                    </td>
                                    <td><%= user.calorieGoal %> kcal</td>
                                    <td>
                                        <div class="badge-advanced badge-success">
                                            <i class="fas fa-check-circle"></i>
                                            Active
                                        </div>
                                    </td>
                                </tr>
                            <% }); %>
                        <% } else { %>
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                                    <i class="fas fa-users" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3; display: block;"></i>
                                    No users yet
                                </td>
                            </tr>
                        <% } %>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<style>
.action-badge {
    margin-top: 1rem;
    padding: 0.5rem 1rem;
    background: rgba(16, 185, 129, 0.1);
    color: var(--primary-color);
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 700;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}
</style>

<%- include('../partials/footer') %>
